<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating the Care Density and Fragmented Care Density in R • CareDensity</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating the Care Density and Fragmented Care Density in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CareDensity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Calculating the Care Density and Fragmented Care Density in R</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/CareDensity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculating the Care Density and Fragmented Care Density in R</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/CareDensity/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>CareDensity</code> package is a small R package that can be
used mainly to calculate various measures of Care Density (Pollack et
al. 2013, Engels et al. 2024) and Coordination of Care Indices (Jee
&amp; Cabana 2006). In this vignette we will show some simple examples
for each index and give some further explanations on what they mean.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This package is currently not available on CRAN, but a developmental
version can be installed from github, using the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"RobinDenz1/CareDensity"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="care-density">Care Density<a class="anchor" aria-label="anchor" href="#care-density"></a>
</h2>
<div class="section level3">
<h3 id="explanation">Explanation<a class="anchor" aria-label="anchor" href="#explanation"></a>
</h3>
<p>The care density was first proposed by Pollack et al. (2013). It is a
measure that is supposed to measure how closely the “care team” of a
patient (the providers / medical doctors he is in contact with) are
connected. As an indirect measure of how closely two providers work
together, the number of patients shared by the providers is used.
Therefore, in order to calculate the care density, the only information
we need is which patient visited which provider. This information can be
considered a “patient-sharing network” and has been used in multiple
studies already (DuGoff et al. 2018, Landon et al. 2012).</p>
<p>Formally, the care density is defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>p</mi></msub><mo>=</mo><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>w</mi><mrow><mi>p</mi><mo>,</mo><mi>j</mi></mrow></msub></mrow><mrow><msub><mi>n</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mi>p</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">C_p = \frac{\sum_{i = 1}^m w_{p, j}}{n_p (n_p - 1)/2},</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>p</mi></msub><annotation encoding="application/x-tex">n_p</annotation></semantics></math>
being the number of providers a patient has visited,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
defined as the number of all possible combinations of length two and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mrow><mi>p</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">w_{p, j}</annotation></semantics></math>
being the number of patients that a pair of provider is sharing.</p>
</div>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>Suppose we have the following data about 5 patients (denoted by
numbers) and the 3 providers they visited (denoted by uppercase
letters):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/CareDensity" class="external-link">CareDensity</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/david-cortes/MatrixExtra" class="external-link">MatrixExtra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3431</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># some arbitrary patient-provider contact data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>PatID<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"1"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span><span class="op">)</span>,</span>
<span>                   ArztID<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"A"</span>, <span class="st">"D"</span>, <span class="st">"D"</span>, <span class="st">"C"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span></span>
<span><span class="co">#&gt;   PatID ArztID</span></span>
<span><span class="co">#&gt; 1     1      A</span></span>
<span><span class="co">#&gt; 2     1      C</span></span>
<span><span class="co">#&gt; 3     1      D</span></span>
<span><span class="co">#&gt; 4     2      A</span></span>
<span><span class="co">#&gt; 5     2      D</span></span>
<span><span class="co">#&gt; 6     3      A</span></span>
<span><span class="co">#&gt; 7     3      D</span></span>
<span><span class="co">#&gt; 8     4      D</span></span>
<span><span class="co">#&gt; 9     5      C</span></span></code></pre></div>
<p>Since there are only connections between patients and providers and
no connections between provider and providers or patients and patients,
this can be considered a <em>bipartite</em> graph. We can visualize this
graph using the <code>igraph</code> package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create graph</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_data_frame.html" class="external-link">graph_from_data_frame</a></span><span class="op">(</span><span class="va">data</span>, directed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add type</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/bipartite_mapping.html" class="external-link">bipartite_mapping</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">type</span></span>
<span></span>
<span><span class="co"># change some things for better plots</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">type</span>, <span class="st">"salmon"</span>, <span class="st">"lightblue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">type</span>, <span class="st">"square"</span>, <span class="st">"circle"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"lightgray"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span>, vertex.label.cex<span class="op">=</span><span class="fl">0.8</span>, vertex.label.color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>Consider patient number 1 in this graph. We can see that this patient
visited 3 different providers
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>C</mi><annotation encoding="application/x-tex">C</annotation></semantics></math>).
Therefore,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>p</mi></msub><annotation encoding="application/x-tex">n_p</annotation></semantics></math>
is equal to 3 for this patient. But how about the weights? To gain a
better understanding, we can <em>project</em> this graph into a
provider-centric network, where only providers are included:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># project to provider mode</span></span>
<span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/project_to_one_mode.html">project_to_one_mode</a></span><span class="op">(</span><span class="va">g</span>, mode<span class="op">=</span><span class="st">"cols"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make it an igraph object again</span></span>
<span><span class="va">g_provider</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_adjacency_matrix.html" class="external-link">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="va">mat</span>, mode<span class="op">=</span><span class="st">"upper"</span>, weighted<span class="op">=</span><span class="cn">TRUE</span>, diag<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot it</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g_provider</span>, edge.label<span class="op">=</span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">g_provider</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span>, vertex.shape<span class="op">=</span><span class="st">"square"</span>,</span>
<span>     edge.color<span class="op">=</span><span class="st">"black"</span>, vertex.color<span class="op">=</span><span class="st">"salmon"</span>,</span>
<span>     vertex.label.cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>In this graph we can see exactly which provider shared how many
patients. So for patient 1 the care density would be:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>1</mn></msub><mo>=</mo><mfrac><mrow><mn>1</mn><mo>+</mo><mn>1</mn><mo>+</mo><mn>3</mn></mrow><mrow><mn>3</mn><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow></mfrac><mo>≈</mo><mn>1.6667</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">C_1 = \frac{1 + 1 + 3}{3 (3 - 1)/2} \approx 1.6667.</annotation></semantics></math></p>
<p>While this is easy to calculate for a single patient in a small
network, it is unfeasible to do this by hand in a large network and for
multiple patients. The <code><a href="../reference/care_density.html">care_density()</a></code> function can be used
to automatically perform the step taken by hand above. All we need to do
is supply the original <code>data</code> to it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/care_density.html">care_density</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PatID sum_weights n care_density</span></span>
<span><span class="co">#&gt; 1     1           5 3     1.666667</span></span>
<span><span class="co">#&gt; 2     2           3 2     3.000000</span></span>
<span><span class="co">#&gt; 3     3           3 2     3.000000</span></span>
<span><span class="co">#&gt; 4     4          NA 1           NA</span></span>
<span><span class="co">#&gt; 5     5          NA 1           NA</span></span></code></pre></div>
<p>Here we can see that it gets the same result for patient 1 and also
outputs the care density for all other patients. Since patient 4 and 5
have only visited one provider, the care density is undefined for them
and is thus denoted by <code>NA</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="fragmented-care-density">Fragmented Care Density<a class="anchor" aria-label="anchor" href="#fragmented-care-density"></a>
</h2>
<div class="section level3">
<h3 id="explanation-1">Explanation<a class="anchor" aria-label="anchor" href="#explanation-1"></a>
</h3>
<p>The care density as defined by Pollack et al. (2014) has recently
been criticed by Engels et al. (2024). Their main point are that:</p>
<ul>
<li>
<strong>1.)</strong> The care density assumes that all relationships
with the same amount of patients shared contribute equally to care
coordination. It therefore does not consider how many patients a single
provider has.</li>
<li>
<strong>2.)</strong> The kind of relationship is also not considered
in the classic care density statistic. For example, relationships
between psychiatrists and general providers may be more or less
important than general provider - general provider relationships.</li>
<li>
<strong>3.)</strong> The importance of specific relationships may
vary for different outcomes and or different patient population, which
is therefore also not considered in the classic care density measure or
Pollack et al. (2024).</li>
</ul>
<p>Engels et al. (2024) instead propose a modified version of the care
density, which they call <em>fragmented care density</em>. The main idea
is to stratify the sum term of the classic care density into multiple
provider-relationship specific sums.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>p</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><mfrac><msub><mi>s</mi><mi>j</mi></msub><mrow><msub><mi>n</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mi>p</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">C_p = \sum_{j = 1}^{k} \frac{s_j}{n_p(n_p - 1) /2},</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
being defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac linethickness="0"><mi>l</mi><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>l</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">k = {l \choose 2} + l,</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>l</mi><annotation encoding="application/x-tex">l</annotation></semantics></math>
is the number of provider types. For example, if we have three different
provider types (psychiatrist, general provider, other), we would have 6
different relationships. It is easy to see that this formulation is
equivalent to the one given by Pollack et al. (2013). The new proposal
is to weight the different connection types differently. The
<em>fragmented care density</em> as proposed by Engels et al. (2024) is
then given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><msub><mi>C</mi><mi>p</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><msub><mi>w</mi><mi>j</mi></msub><mfrac><msub><mi>s</mi><mi>j</mi></msub><mrow><msub><mi>n</mi><mi>p</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mi>p</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mn>2</mn></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">FC_p = \sum_{j = 1}^{k} w_j \frac{s_j}{n_p(n_p - 1) /2}.</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>j</mi></msub><annotation encoding="application/x-tex">w_j</annotation></semantics></math>
are some connection specific weights. Engels et al. (2024) propose to
use regression models to estimate these weights. This is explained in a
little more detail below.</p>
</div>
<div class="section level3">
<h3 id="example-1">Example<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>Consider again the example dataset defined above. Suppose, however,
that each provider is known to be either a general practitioner or a
psychiatrist. The following <code>data.frame</code> defines the type of
each provider in our example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>,</span>
<span>                     Type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GP"</span>, <span class="st">"GP"</span>, <span class="st">"Psychiatrist"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d_type</span></span>
<span><span class="co">#&gt;   ID         Type</span></span>
<span><span class="co">#&gt; 1  A           GP</span></span>
<span><span class="co">#&gt; 2  C           GP</span></span>
<span><span class="co">#&gt; 3  D Psychiatrist</span></span></code></pre></div>
<p>Since there are two different kinds of providers, there are 3
possible provider connections:</p>
<ul>
<li>GP - GP</li>
<li>GP - Psychiatrist</li>
<li>Psychiatrist - Psychiatrist</li>
</ul>
<p>We can safely omit the “Psychiatrist - GP” connection type, because
we are always dealing with undirected connections, which means that the
order of appearance does not make a difference. Now we can use the
<code><a href="../reference/fragmented_care_density.html">fragmented_care_density()</a></code> function as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fragmented_care_density.html">fragmented_care_density</a></span><span class="op">(</span><span class="va">data</span>, weights<span class="op">=</span><span class="cn">NULL</span>, type<span class="op">=</span><span class="va">d_type</span>, by_connection<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PatID        connection sum_weights n care_density</span></span>
<span><span class="co">#&gt; 1     1           GP - GP           1 3    0.3333333</span></span>
<span><span class="co">#&gt; 2     1 Psychiatrist - GP           4 3    1.3333333</span></span>
<span><span class="co">#&gt; 3     2 Psychiatrist - GP           3 2    3.0000000</span></span>
<span><span class="co">#&gt; 4     3 Psychiatrist - GP           3 2    3.0000000</span></span>
<span><span class="co">#&gt; 5     4              &lt;NA&gt;          NA 1           NA</span></span>
<span><span class="co">#&gt; 6     5              &lt;NA&gt;          NA 1           NA</span></span></code></pre></div>
<p>By setting <code>by_connection</code> to <code>TRUE</code> we are
telling the function to not directly calculate the fragmented care
density for us, but to instead return the sum of the weights and care
densities per connection type and patient. From this dataset we can see
that only patient 1 has two different kinds of provider connections
among his network. If we sum up the care densities of each patient over
all his connection types, we get the classic care density.</p>
<p>To calculate the actual fragmented care density for each patient, we
need to supply <code>weights</code> for each connection type. We can do
this by constructing a <code>data.frame</code> that looks like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GP"</span>, <span class="st">"GP"</span>, <span class="st">"Psychiatrist"</span><span class="op">)</span>,</span>
<span>                        to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GP"</span>, <span class="st">"Psychiatrist"</span>, <span class="st">"Psychiatrist"</span><span class="op">)</span>,</span>
<span>                        weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d_weights</span></span>
<span><span class="co">#&gt;           from           to weight</span></span>
<span><span class="co">#&gt; 1           GP           GP      1</span></span>
<span><span class="co">#&gt; 2           GP Psychiatrist      1</span></span>
<span><span class="co">#&gt; 3 Psychiatrist Psychiatrist      1</span></span></code></pre></div>
<p>Here, we set all weights to 1. Therefore, if we now call the
<code><a href="../reference/fragmented_care_density.html">fragmented_care_density()</a></code> function again (this time without
using the <code>by_connection</code> argument):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fragmented_care_density.html">fragmented_care_density</a></span><span class="op">(</span><span class="va">data</span>, weights<span class="op">=</span><span class="va">d_weights</span>, type<span class="op">=</span><span class="va">d_type</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PatID fragmented_care_density</span></span>
<span><span class="co">#&gt; 1     1                1.666667</span></span>
<span><span class="co">#&gt; 2     2                3.000000</span></span>
<span><span class="co">#&gt; 3     3                3.000000</span></span>
<span><span class="co">#&gt; 4     4                      NA</span></span>
<span><span class="co">#&gt; 5     5                      NA</span></span></code></pre></div>
<p>we get the same results as we did before when using the simple
<code><a href="../reference/care_density.html">care_density()</a></code> function. However, if we use different
weights for each connection type:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>from<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GP"</span>, <span class="st">"GP"</span>, <span class="st">"Psychiatrist"</span><span class="op">)</span>,</span>
<span>                        to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GP"</span>, <span class="st">"Psychiatrist"</span>, <span class="st">"Psychiatrist"</span><span class="op">)</span>,</span>
<span>                        weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">0.5</span>, <span class="fl">1.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d_weights</span></span>
<span><span class="co">#&gt;           from           to weight</span></span>
<span><span class="co">#&gt; 1           GP           GP    1.1</span></span>
<span><span class="co">#&gt; 2           GP Psychiatrist    0.5</span></span>
<span><span class="co">#&gt; 3 Psychiatrist Psychiatrist    1.3</span></span></code></pre></div>
<p>and call the function again:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fragmented_care_density.html">fragmented_care_density</a></span><span class="op">(</span><span class="va">data</span>, weights<span class="op">=</span><span class="va">d_weights</span>, type<span class="op">=</span><span class="va">d_type</span><span class="op">)</span></span>
<span><span class="co">#&gt;   PatID fragmented_care_density</span></span>
<span><span class="co">#&gt; 1     1                1.033333</span></span>
<span><span class="co">#&gt; 2     2                1.500000</span></span>
<span><span class="co">#&gt; 3     3                1.500000</span></span>
<span><span class="co">#&gt; 4     4                      NA</span></span>
<span><span class="co">#&gt; 5     5                      NA</span></span></code></pre></div>
<p>we obtain different results. Note that this never matters for
patients 4 and 5, because they only have one provider connection,
resulting in <code>NA</code> values no matter the weights.</p>
</div>
<div class="section level3">
<h3 id="estimating-connection-specific-weights">Estimating Connection-Specific Weights<a class="anchor" aria-label="anchor" href="#estimating-connection-specific-weights"></a>
</h3>
<p>In the example above, we used arbitrary weights to showcase the
functionality of the <code><a href="../reference/fragmented_care_density.html">fragmented_care_density()</a></code> function. In
reality we would like to use sensible weights instead. Engels et
al. (2024) recommend using regression models to obtain the relevant
weights. In their article, they use a logistic regression model to
predict a binary outcome, given the presence of a connection type and
some covariates. We will illustrate this approach here without the use
of other covariates.</p>
<p>Suppose in addition to <code>data</code> (patient-provider
relationships) and <code>type</code> (the provider types) we also have
some patient level information on a binary outcome of interest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.
Suppose this is that data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>PatID<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span><span class="op">)</span>,</span>
<span>                        Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d_outcome</span></span>
<span><span class="co">#&gt;   PatID Y</span></span>
<span><span class="co">#&gt; 1     1 0</span></span>
<span><span class="co">#&gt; 2     2 0</span></span>
<span><span class="co">#&gt; 3     3 1</span></span>
<span><span class="co">#&gt; 4     4 1</span></span>
<span><span class="co">#&gt; 5     5 0</span></span></code></pre></div>
<p>First, we again obtain data about the connection sums
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>j</mi></msub><annotation encoding="application/x-tex">s_j</annotation></semantics></math>)
per connection type:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_consum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fragmented_care_density.html">fragmented_care_density</a></span><span class="op">(</span><span class="va">data</span>, weights<span class="op">=</span><span class="cn">NULL</span>, type<span class="op">=</span><span class="va">d_type</span>, by_connection<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We then binarize these weights to 0 / 1. If at least one connection
is present, it is considered a 1, otherwise it is a 0:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_consum</span><span class="op">$</span><span class="va">sum_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">d_consum</span><span class="op">$</span><span class="va">sum_weights</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Next, we transform this information into the long-format using the
<code><a href="https://rdrr.io/pkg/data.table/man/dcast.data.table.html" class="external-link">dcast()</a></code> function of the <code>data.table</code>
package:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_consum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">d_consum</span><span class="op">)</span>, <span class="va">PatID</span> <span class="op">~</span> <span class="va">connection</span>,</span>
<span>                  value.var<span class="op">=</span><span class="st">"sum_weights"</span>, fill<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">d_consum</span><span class="op">$</span><span class="va">`NA`</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Afterwards we can merge the outcome data to this dataset:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">d_consum</span>, <span class="va">d_outcome</span>, by<span class="op">=</span><span class="st">"PatID"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can finally fit the regression model, using the outcome as the
dependent variable and the connection-type dummies as independent
variables:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">`GP - GP`</span> <span class="op">+</span> <span class="va">`Psychiatrist - GP`</span>, data<span class="op">=</span><span class="va">d_outcome</span>, family<span class="op">=</span><span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = Y ~ `GP - GP` + `Psychiatrist - GP`, family = "binomial", </span></span>
<span><span class="co">#&gt;     data = d_outcome)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                       Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">#&gt; (Intercept)         -1.256e-16  1.414e+00   0.000    1.000</span></span>
<span><span class="co">#&gt; `GP - GP`           -1.857e+01  6.523e+03  -0.003    0.998</span></span>
<span><span class="co">#&gt; `Psychiatrist - GP`  0.000e+00  2.000e+00   0.000    1.000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 6.7301  on 4  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 5.5452  on 2  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 11.545</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 17</span></span></code></pre></div>
<p>The estimated coefficients associated with each connection type may
now be used as weights. Note that in this example the weights don’t make
any sense due to (1) the very low sample size, (2) the very small
network and (3) because all data is completely made up with no
underlying true relationships. The general procedure, however, should
work with real data.</p>
</div>
</div>
<div class="section level2">
<h2 id="literature">Literature<a class="anchor" aria-label="anchor" href="#literature"></a>
</h2>
<p>DuGoff, Eva H., Sara Fernandes-Taylor, Gary E. Weissman, Joseph H.
Huntley, and Craig Evan Pollack. (2018). “A Scoping Review of
Patient-Sharing Network Studies Using Administrative Data”.
Translational Behavioral Medicine 8 (4), pp. 598-625.</p>
<p>Engels, Alexander, Claudia Konnopka, Espen Henken, Martin Härter, and
Hans-Helmut König. (2024). “A Flexible Approach to Measure Care
Coordination Based on Patient-Sharing Networks”. BMC Medical Research
Methodology 24 (1), pp. 1-12.</p>
<p>Jee, Sandra H., and Michael D. Cabana. (2006). “Indices for
Continuity of Care: A Systematic Review of the Literature”. Medical Care
Research and Review 63 (2), pp. 158-188.</p>
<p>Landon, Bruce E., Nancy L. Keating, Michael L. Barnett, Jukka-Pekka
Onnela, Sudeshna Paul, A. James O’Malley, Thomas Keegan, and Nicholas A.
Christakis. (2012). “Variation in Patient-Sharing Networks of Physicians
Across the United States”. JAMA 308 (3): pp. 265-273.</p>
<p>Pollack, Craig Evan, Gary E. Weissman, Klaus W. Lemke, Peter S.
Hussey, and Jonathan P. Weiner. (2013). “Patient Sharing Among
Physicians and Costs of Care: A Network Analytic Approach to Care
Coordination Using Claims Data”. Journal of General Internal Medicine 28
(3), pp. 459-465.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
